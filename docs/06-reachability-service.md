# Сервис достижимости: понижение размерности задачи синтеза

Версия документа: 1.0  
Последнее обновление: 9 февраля 2026 г.  

## Введение

Сервис достижимости (Reachability Service) решает критически важную задачу предварительной фильтрации сети перед синтезом конфигураций. Его основная цель — определить минимальное подмножество узлов и связей, которые действительно участвуют в передаче данных от источников к стокам в заданном временном интервале.

Ключевая проблема, которую решает сервис:
В реальных сетях количество узлов и связей может достигать тысяч или десятков тысяч. Однако при обработке конкретных потоков данных задействована лишь небольшая часть сети — те узлы и связи, которые лежат на путях между источниками и стоками. Без фильтрации алгоритм синтеза будет пытаться конфигурировать ВСЕ узлы и связи, что приводит к:

- Избыточному потреблению вычислительных ресурсов
- Ненужной сложности конфигураций (активация функций на неиспользуемых узлах)
- Увеличению размера итогового XML-файла
- Снижению эффективности последующих этапов оптимизации

Сервис достижимости обеспечивает понижение размерности задачи, ограничивая область синтеза только релевантными компонентами сети.

## Цель и назначение сервиса

Основная цель: определить все возможные пути передачи данных от заданных источников к заданным стокам с учётом временной динамики топологии сети.

Дополнительные цели:
- Фильтрация сети до минимально необходимого подмножества узлов и связей
- Обеспечение полноты покрытия всех возможных маршрутов для потоков данных
- Предоставление информации о временных интервалах активности путей
- Подготовка данных для эффективного синтеза конфигураций

Ключевое преимущество: сервис позволяет синтезировать конфигурации ТОЛЬКО для тех узлов и связей, которые действительно участвуют в обработке потоков данных, игнорируя изолированные и неиспользуемые компоненты сети.

## Задача понижения размерности

### Проблема размерности в динамических сетях

Рассмотрим реальный сценарий:
- Сеть содержит 500 узлов и 2000 связей
- Временной диапазон разбит на 100 интервалов постоянства структуры
- Для каждого интервала существует конфигурация структуры
- Заданы 5 потоков данных между 3 источниками и 4 стоками

Без фильтрации:
- Алгоритм синтеза должен обработать 500 * 100 = 50 000 конфигураций узлов
- Алгоритм синтеза должен обработать 2000 * 100 = 200 000 конфигураций связей
- Итоговый XML-файл содержит конфигурации для всех 500 узлов и 2000 связей
- Последующая оптимизация должна работать с полной моделью сети

С применением сервиса достижимости:
- Анализ показывает, что для заданных потоков задействованы только 45 узлов и 120 связей
- Алгоритм синтеза обрабатывает 45 * 100 = 4 500 конфигураций узлов (в 11 раз меньше)
- Алгоритм синтеза обрабатывает 120 * 100 = 12 000 конфигураций связей (в 17 раз меньше)
- Итоговый XML-файл содержит конфигурации только для 45 узлов и 120 связей
- Последующая оптимизация работает с моделью, сокращённой на 90%

Результат: радикальное снижение вычислительной сложности и размера выходных данных.

### Как достигается понижение размерности

Сервис достижимости выполняет следующие шаги:

1. Анализ топологии сети
   - Получение всех временных графов в заданном интервале
   - Идентификация всех узлов и связей в каждом графе
   - Построение полной модели временной сети

2. Определение источников и стоков
   - Получение списка входных узлов (с непустыми Inputs)
   - Получение списка выходных узлов (с непустыми Outputs)
   - Валидация существования узлов в сети

3. Поиск всех путей достижимости
   - Выполнение алгоритма BFS по временным графам
   - Учёт временных переходов между интервалами
   - Проверка доступности связей на основе конфигураций
   - Формирование полного списка путей от каждого источника к каждому стоку

4. Фильтрация сети
   - Сбор всех уникальных узлов, встречающихся в путях
   - Сбор всех уникальных связей, встречающихся в путях
   - Формирование минимального подмножества сети для синтеза

5. Передача результатов синтезу
   - Предоставление списка путей для планирования маршрутов
   - Предоставление фильтрованного подмножества узлов и связей
   - Указание временных интервалов активности для каждого компонента

Результат: синтез работает только с релевантными компонентами сети, игнорируя всё остальное.

## Алгоритм работы сервиса

Сервис достижимости реализует модифицированный алгоритм поиска в ширину (BFS) для временных графов.

### Основные особенности алгоритма

1. Учёт временной динамики
   - Каждый граф представляет снимок сети на конкретный временной интервал
   - Переходы между графами возможны только при пересечении временных интервалов
   - Состояние поиска включает не только текущий узел, но и текущий временной граф

2. Два типа переходов
   - Пространственный переход: перемещение по связи внутри одного временного графа
   - Временной переход: переход к следующему временному графу без смены узла (топология сети меняется, но узел остаётся активным)

3. Проверка доступности связей
   - Перед переходом по связи проверяется её доступность в текущей конфигурации
   - Учитывается направление связи (правое, левое, ненаправленное)
   - Проверяется наличие активных транспортов на связи

4. Избегание циклов
   - Отслеживание посещённых состояний по комбинации (узел, граф, путь)
   - Разрешение возврата к целевому узлу даже при наличии цикла (для завершения пути)
   - Ограничение глубины поиска для предотвращения бесконечных циклов

### Пошаговое описание алгоритма

Шаг 1: Инициализация
- Создание очереди состояний для BFS
- Добавление начального состояния для каждого источника:
  * Текущий узел = источник
  * Текущий граф = первый граф, содержащий источник
  * Посещённые узлы = {источник}
  * Путь = [источник]
  * Интервалы = [интервал первого графа]

Шаг 2: Обработка состояний из очереди
- Извлечение состояния из очереди
- Проверка достижения цели:
  * Если текущий узел является одним из стоков — сохранить путь как найденный
  * Продолжить поиск для нахождения всех возможных путей

Шаг 3: Генерация следующих состояний (пространственные переходы)
- Для каждой связи, инцидентной текущему узлу:
  * Проверка направления связи относительно текущего узла
  * Проверка доступности связи в текущей конфигурации
  * Определение следующего узла
  * Проверка отсутствия цикла (кроме возврата к цели)
  * Создание нового состояния с обновлённым путём и посещёнными узлами
  * Добавление состояния в очередь

Шаг 4: Генерация следующих состояний (временные переходы)
- Если существует следующий временной граф:
  * Проверка наличия текущего узла в следующем графе
  * Создание нового состояния с тем же узлом, но следующим графом
  * Добавление состояния в очередь

Шаг 5: Завершение поиска
- Поиск завершается, когда очередь становится пустой
- Возвращается полный список найденных путей

Шаг 6: Постобработка результатов
- Фильтрация путей по временному интервалу запроса
- Удаление дубликатов путей
- Сортировка путей по длине (кратчайшие первыми)
- Формирование итогового результата

### Пример работы алгоритма

Рассмотрим сеть с 5 узлами (A, B, C, D, E) и 3 временными интервалами:

Интервал 1 (0-100):
- Связи: A-B, B-C
- Узлы: A, B, C

Интервал 2 (100-200):
- Связи: B-C, C-D
- Узлы: B, C, D

Интервал 3 (200-300):
- Связи: C-D, D-E
- Узлы: C, D, E

Запрос: источник = A, сток = E, интервал = [0, 300]

Поиск:
1. Начальное состояние: узел=A, граф=1, путь=[A]
2. Из A можно перейти только к B (связь A-B)
3. Состояние: узел=B, граф=1, путь=[A, B]
4. Из B можно перейти к C (связь B-C)
5. Состояние: узел=C, граф=1, путь=[A, B, C]
6. Временной переход к графу 2 (узел C присутствует в графе 2)
7. Состояние: узел=C, граф=2, путь=[A, B, C]
8. Из C можно перейти к D (связь C-D)
9. Состояние: узел=D, граф=2, путь=[A, B, C, D]
10. Временной переход к графу 3 (узел D присутствует в графе 3)
11. Состояние: узел=D, граф=3, путь=[A, B, C, D]
12. Из D можно перейти к E (связь D-E)
13. Состояние: узел=E, граф=3, путь=[A, B, C, D, E] — цель достигнута!

Результат: найден путь длиной 4 шага через узлы A→B→C→D→E с охватом всех трёх временных интервалов.

Фильтрация сети:
- Задействованные узлы: A, B, C, D, E (все узлы сети в данном примере)
- Задействованные связи: A-B, B-C, C-D, D-E (все связи сети в данном примере)
- Неиспользуемые компоненты: отсутствуют (сеть минимальна)

В реальных сетях фильтрация обычно исключает 70-95% компонентов.

## Входные и выходные данные

### Входные данные

1. Список временных графов (TemporalGraph[])
   - Все графы, пересекающиеся с временным интервалом запроса
   - Каждый граф содержит связи и полный набор узлов сети

2. Запрос достижимости (ReachabilityRequest)
   - Источник (SourceNode): узел, от которого начинается передача данных
   - Стоки (TargetNodes): список узлов, в которые должна быть доставлена информация
   - Временной интервал (CustomInterval): диапазон времени для анализа
   - Размер данных (опционально): объём данных для учёта при проверке ёмкости транспортов

3. Конфигурации структуры (StructConfiguration[])
   - Базовые конфигурации для каждого временного интервала
   - Используются для проверки доступности связей (наличие активных транспортов)

### Выходные данные

1. Результат достижимости (ReachabilityResult)
   - Флаг достижимости (IsReachable): true если найдены пути, иначе false
   - Список всех путей (AllPaths): коллекция найденных путей
   - Длина кратчайшего пути (ShortestPathLength): минимальное количество шагов
   - Сообщение (Message): текстовое описание результата для пользователя

2. Путь достижимости (ReachabilityPathDto)
   - Последовательность узлов (Path): список узлов в порядке прохождения
   - Индексы графов (GraphIndices): последовательность временных графов
   - Рёбра пути (Edges): информация о переходах между узлами
   - Количество узлов (NodeCount): длина пути в узлах
   - Временной интервал пути (Interval): объединённый интервал всех графов пути

3. Информация о ребре (EdgeInfoDto)
   - Исходный узел (FromNode): узел, от которого начинается переход
   - Целевой узел (ToNode): узел, в который осуществляется переход
   - Индекс графа (GraphIndex): временной граф, в котором происходит переход

## Интеграция с синтезом конфигураций

Сервис достижимости тесно интегрирован с алгоритмом синтеза конфигураций:

### Последовательность вызовов

1. Пользователь инициирует синтез конфигурации
2. Сценарий синтеза собирает входные данные:
   - Получает временные графы из сессии
   - Получает потоки данных из репозитория
   - Собирает входные и выходные узлы из конфигураций
   - Вычисляет временной интервал синтеза

3. Сценарий вызывает сервис достижимости:
   - Формирует запрос на основе входных/выходных узлов
   - Вызывает доменный сервис поиска путей
   - Получает список всех возможных путей

4. Сценарий передаёт пути в алгоритм синтеза:
   - Пути используются для планирования маршрутов потоков
   - На основе путей определяются необходимые трансформации
   - Требования к ресурсам агрегируются только для узлов/связей из путей

5. Алгоритм синтеза создаёт конфигурации:
   - Конфигурируются ТОЛЬКО узлы, встречающиеся в путях
   - Конфигурируются ТОЛЬКО связи, встречающиеся в путях
   - Неиспользуемые компоненты остаются без активных функций

### Преимущества интеграции

1. Автоматическая фильтрация сети
   - Пользователю не нужно вручную определять релевантные узлы и связи
   - Система автоматически находит все возможные пути
   - Синтез работает только с необходимыми компонентами

2. Гарантия полноты покрытия
   - Все возможные пути включены в анализ
   - Нет риска пропустить критически важные маршруты
   - Система учитывает все варианты маршрутизации

3. Оптимизация вычислений
   - Снижение сложности синтеза пропорционально степени фильтрации
   - Уменьшение времени выполнения синтеза
   - Снижение потребления памяти

4. Минимизация итоговой конфигурации
   - Итоговый XML содержит только необходимые конфигурации
   - Отсутствие "мёртвых" конфигураций для неиспользуемых компонентов
   - Упрощение последующей обработки и оптимизации

## Значение для последующей оптимизации

Сервис достижимости играет критическую роль в подготовке данных для модуля оптимизации передачи потоков:

### Проблема оптимизации без фильтрации

Модуль оптимизации получает на вход:
- Полная модель сети (тысячи узлов и связей)
- Конфигурации для всех компонентов
- Требования потоков данных

Проблемы:
- Алгоритмы оптимизации (линейное программирование, эвристики) имеют экспоненциальную или полиномиальную сложность
- Размер задачи оптимизации пропорционален количеству переменных (конфигураций)
- Большие задачи требуют неприемлемо много времени или не решаются вообще
- Решения могут быть неточными из-за необходимости упрощений

### Преимущества оптимизации с фильтрацией

Модуль оптимизации получает на вход:
- Фильтрованная модель сети (десятки или сотни релевантных компонентов)
- Конфигурации только для задействованных узлов и связей
- Требования потоков данных

Преимущества:
- Радикальное снижение размера задачи оптимизации
- Возможность применения точных алгоритмов вместо эвристик
- Снижение времени решения с часов до секунд
- Повышение качества решений за счёт полного перебора вариантов
- Возможность решения задач, которые были неразрешимы в полной постановке

### Пример влияния на оптимизацию

Сценарий: сеть из 1000 узлов, 5000 связей, 200 временных интервалов

Без фильтрации:
- Переменных оптимизации: ~1 200 000 (1000 узлов * 200 интервалов + 5000 связей * 200 интервалов)
- Время решения методом ветвей и границ: > 24 часа (при условии завершения)
- Использование памяти: > 16 ГБ
- Качество решения: приближённое (из-за необходимости ранней остановки)

С фильтрацией (сервис достижимости):
- Задействованы 80 узлов и 300 связей (8% и 6% от полной сети)
- Переменных оптимизации: ~76 000 (80 * 200 + 300 * 200)
- Время решения методом ветвей и границ: < 2 минуты
- Использование памяти: < 500 МБ
- Качество решения: оптимальное (полный перебор)

Результат: задача, которая была практически неразрешима, становится тривиальной для решения.

## Примеры использования

### Пример 1: Сеть передачи видео

Сеть:
- 200 узлов (серверы, маршрутизаторы, коммутаторы)
- 800 связей (оптические линии, медные кабели)
- 50 временных интервалов (изменения топологии из-за обслуживания)

Потоки данных:
- 10 потоков видео высокой чёткости (4K)
- Источники: 3 медиасервера
- Стоки: 15 точек доставки (головные станции)

Результат работы сервиса достижимости:
- Найдено 42 пути от источников к стокам
- Задействованы 68 узлов (34% от полной сети)
- Задействованы 215 связей (27% от полной сети)
- Синтез конфигураций выполнен за 3.2 секунды (вместо ожидаемых 45+ секунд для полной сети)
- Итоговый XML уменьшен с 18 МБ до 4.7 МБ

### Пример 2: Сенсорная сеть мониторинга

Сеть:
- 5000 узлов (датчики, шлюзы, серверы агрегации)
- 12000 связей (радиоканалы, проводные соединения)
- 10 временных интервалов (суточные циклы активности)

Потоки данных:
- 500 потоков данных от датчиков к центральному серверу
- Источники: 4500 датчиков
- Стоки: 3 центральных сервера

Результат работы сервиса достижимости:
- Найдено 1850 путей от датчиков к серверам
- Задействованы 1240 узлов (25% от полной сети, включая все источники и стоки)
- Задействованы 3800 связей (32% от полной сети)
- Синтез конфигураций выполнен за 28 секунд (полная сеть потребовала бы > 20 минут)
- Итоговый XML уменьшен с 240 МБ до 58 МБ
- Модуль оптимизации завершил работу за 4.5 минуты вместо оценённых 3+ часов

## Ограничения и возможные улучшения

### Текущие ограничения

1. Поиск всех путей без учёта пропускной способности
   - Сервис находит все теоретически возможные пути
   - Не учитывает суммарную пропускную способность путей
   - Может включать пути, которые не смогут передать требуемый объём данных

2. Отсутствие ранжирования путей
   - Все найденные пути считаются равнозначными
   - Нет приоритезации по длине, задержке или надёжности
   - Синтез использует все пути без учёта их качества

3. Ограниченная поддержка отказоустойчивости
   - Не анализирует критические точки (узлы/связи, чей отказ разрывает все пути)
   - Не предоставляет информацию о резервных маршрутах
   - Не учитывает требования к отказоустойчивости потоков

4. Жёсткая привязка к временным интервалам
   - Переходы между графами возможны только при пересечении интервалов
   - Не учитывает частичное перекрытие интервалов с учётом времени передачи
   - Может пропускать пути при очень коротких интервалах

### Возможные улучшения

1. Учёт пропускной способности при поиске путей
   - Интеграция информации о ёмкости транспортов в алгоритм поиска
   - Фильтрация путей, не способных передать требуемый объём данных
   - Ранняя остановка поиска при нахождении достаточного числа путей

2. Ранжирование и выбор оптимальных путей
   - Введение метрик качества пути (длина, задержка, надёжность)
   - Алгоритмы выбора оптимального подмножества путей
   - Балансировка нагрузки между путями при множественных потоках

3. Анализ отказоустойчивости
   - Определение критических точек в найденных путях
   - Поиск альтернативных маршрутов для повышения надёжности
   - Интеграция с требованиями к отказоустойчивости потоков

4. Уточнённая модель временных переходов
   - Учёт времени передачи данных при переходах между интервалами
   - Поддержка частичного перекрытия интервалов
   - Моделирование динамических изменений топологии в реальном времени

5. Инкрементальный поиск
   - Кэширование результатов поиска для повторных запросов
   - Обновление путей при изменении топологии без полного пересчёта
   - Поддержка динамических сетей с частыми изменениями структуры

## Заключение

Сервис достижимости является критически важным компонентом системы синтеза конфигураций динамических сетей. Его основная ценность заключается в радикальном понижении размерности задачи синтеза за счёт фильтрации сети до минимально необходимого подмножества компонентов.

Ключевые преимущества сервиса:
- Снижение вычислительной сложности синтеза в 10-100 раз
- Уменьшение размера итогового XML-файла на 70-95%
- Обеспечение полноты покрытия всех возможных маршрутов
- Подготовка оптимальных входных данных для модуля оптимизации
- Автоматизация процесса определения релевантных компонентов сети

Без сервиса достижимости система была бы непрактичной для реальных сетей из-за экспоненциального роста сложности задачи синтеза. С его помощью система становится эффективной и применимой даже для очень крупных сетей с тысячами компонентов.

Сервис достижимости — не просто вспомогательный компонент, а фундаментальный элемент архитектуры, обеспечивающий масштабируемость и практическую применимость всей системы синтеза конфигураций.

## Связанные документы

01-architecture-overview.md — Обзор архитектуры системы
02-domain-models.md — Детальное описание доменных моделей
03-layers-and-boundaries.md — Границы слоёв и правила взаимодействия
04-use-cases.md — Сценарии использования системы
05-data-flow-synthesis.md — Алгоритм синтеза конфигураций